<p-toast key="success" position="top-right"></p-toast>
<p-dialog
    i18n="productModalAddTitle"
    header="Agregar Producto"
    [modal]="true"
    (onHide)="closeModal()"
    [(visible)]="visible"
    [style]="{ width: '40rem', height: '90rem' }">
    <form [formGroup]="productForm" class="flex flex-col gap-4">
        <div class="flex flex-col gap-2">
            <label i18n="productSkuFormLabel" for="sku" class="font-light w-24">SKU</label>
            <input i18n-placeholder="productSkuFormPlaceholder" placeholder="Identificador del producto" pInputText id="sku" formControlName="sku" class="w-full" autocomplete="off" />
            <small i18n="productSkuFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('sku')?.invalid && productForm.get('sku')?.touched">Este campo es requerido</small>
        </div>
        <div class="flex flex-col gap-2">
            <label i18n="productNameFormLabel" for="name" class="font-light w-24">Nombre</label>
            <input i18n-placeholder="productNameFormPlaceholder" placeholder="Nombre del producto" pInputText id="name" formControlName="name" class="w-full" autocomplete="off" />
            <small i18n="productNameFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched">Este campo es requerido</small>
        </div>
        <div class="flex flex-col gap-2">
            <label i18n="productDescriptionFormLabel" for="description" class="font-light w-24">Descripción</label>
            <input i18n-placeholder="productDescriptionFormPlaceholder" placeholder="Descripción del producto" pInputText id="description" formControlName="description" class="w-full" autocomplete="off" />
            <small i18n="productDescriptionFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('description')?.invalid && productForm.get('description')?.touched">Este campo es requerido</small>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-2">
                <label i18n="productCategoryFormLabel" for="category" class="font-light">Categoría</label>
                <p-select
                    [options]="categories"
                    formControlName="category"
                    optionLabel="name"
                    [filter]="true"
                    filterBy="name"
                    [showClear]="true"
                    placeholder="Seleccione"
                    class="w-full">
                </p-select>
                <small i18n="productCategoryFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('category')?.invalid && productForm.get('category')?.touched">Este campo es requerido</small>
            </div>
            <div class="flex flex-col gap-2">
                <label i18n="productBrandFormLabel" for="brand" class="font-light">Marca</label>
                <p-select
                    [options]="brands"
                    formControlName="brand"
                    optionLabel="name"
                    [filter]="true"
                    filterBy="name"
                    [showClear]="true"
                    placeholder="Seleccione"
                    class="w-full">
                </p-select>
                <small i18n="productBrandFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('brand')?.invalid && productForm.get('brand')?.touched">Este campo es requerido</small>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div class="flex flex-col gap-2">
                <label i18n="productMakerFormLabel" for="maker" class="font-light">Fabricante</label>
                <p-select
                    [options]="makers"
                    formControlName="maker"
                    optionLabel="name"
                    [filter]="true"
                    filterBy="name"
                    [showClear]="true"
                    placeholder="Seleccione"
                    class="w-full">
                </p-select>
                <small i18n="productMakerFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('maker')?.invalid && productForm.get('maker')?.touched">Este campo es requerido</small>
            </div>
            <div class="flex flex-col gap-2">
                <label i18n="productUnitFormLabel" for="unit" class="font-light">Unidad de medida</label>
                <p-select
                    [options]="units"
                    formControlName="unit"
                    optionLabel="name"
                    [filter]="true"
                    filterBy="name"
                    [showClear]="true"
                    placeholder="Seleccione"
                    class="w-full">
                </p-select>
                <small i18n="productUnitFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('unit')?.invalid && productForm.get('unit')?.touched">Este campo es requerido</small>
            </div>
        </div>
        <div class="flex flex-col gap-2">
            <label i18n="productMeasurementsFormLabel" class="font-light">Medidas</label>
            <div class="grid grid-cols-3 gap-4">
                <div class="flex flex-col gap-2">
                    <input i18n-placeholder="productHeightFormPlaceholder" placeholder="Alto (cm)" pInputText id="alto" formControlName="alto" class="w-full" autocomplete="off" />
                    <small i18n="productHeightFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('alto')?.invalid && productForm.get('alto')?.touched">Este campo es requerido</small>
                </div>
                <div class="flex flex-col gap-2">
                    <input i18n-placeholder="productWidthFormPlaceholder" placeholder="Ancho (cm)" pInputText id="ancho" formControlName="ancho" class="w-full" autocomplete="off" />
                    <small i18n="productWidthFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('ancho')?.invalid && productForm.get('ancho')?.touched">Este campo es requerido</small>
                </div>
                <div class="flex flex-col gap-2">
                    <input i18n-placeholder="productLengthFormPlaceholder" placeholder="Largo (cm)" pInputText id="largo" formControlName="largo" class="w-full" autocomplete="off" />
                    <small i18n="productLengthFormPlaceholderWarn" class="text-red-500" *ngIf="productForm.get('largo')?.invalid && productForm.get('largo')?.touched">Este campo es requerido</small>
                </div>
            </div>
        </div>
        <div class="flex flex-col gap-2">
            <label i18n="productImageFormLabel" for="name" class="font-light">Imagen</label>
            <p-fileupload
                #fileUpload
                class="w-full"
                name="myfile[]"
                [customUpload]="true"
                [multiple]="false"
                accept="image/*"
                [maxFileSize]="1000000"
                (uploadHandler)="uploadEvent($event)"
                (onSelect)="onSelectedFiles($event)"
                chooseLabel="Seleccionar imagen"
                [showUploadButton]="false"
                [showCancelButton]="false">
                <ng-template pTemplate="toolbar">
                    <div class="flex flex-wrap justify-between items-center flex-1 gap-4">
                        <div class="flex gap-2">
                            <p-button
                                *ngIf="files.length > 0"
                                icon="pi pi-times"
                                [rounded]="true"
                                [outlined]="true"
                                severity="danger"
                                (onClick)="fileUpload.clear()" />
                        </div>
                    </div>
                </ng-template>
                <ng-template pTemplate="content">
                    <div class="flex flex-col gap-8 pt-4">
                        <div *ngIf="files && files.length > 0">
                            <h5 i18n="productNewImageLabel">Nueva imagen</h5>
                            <div class="flex flex-wrap gap-2">
                                <div *ngFor="let file of files; let i = index"
                                    class="p-4 rounded-lg flex flex-col border border-surface items-center gap-4 w-48">
                                    <div>
                                        <img
                                            role="presentation"
                                            [alt]="file.name"
                                            [src]="file.objectURL"
                                            width="250"
                                            height="250"
                                            style="object-fit: contain;" />
                                    </div>
                                    <span class="font-light text-ellipsis max-w-60 whitespace-nowrap overflow-hidden text-xs">
                                        {{ truncateFileName(file.name) }}
                                    </span>
                                    <div>{{ formatSize(file.size) }}</div>
                                    <p-badge value="Nueva" severity="info" />
                                </div>
                            </div>
                        </div>
                        <div *ngIf="uploadedFiles && uploadedFiles.length > 0" class="mt-4">
                            <h5 i18n="productUploadedImagesLabel">Imágenes del producto</h5>
                            <div class="flex flex-wrap gap-4">
                                <div *ngFor="let file of uploadedFiles; let i = index"
                                    class="p-4 rounded-lg flex flex-col border border-surface items-center gap-4 w-48">
                                    <div>
                                        <img
                                            role="presentation"
                                            [alt]="file.name"
                                            [src]="file.objectURL"
                                            width="250"
                                            height="250"
                                            style="object-fit: contain;" />
                                    </div>
                                    <span class="font-light text-ellipsis max-w-60 whitespace-nowrap overflow-hidden text-xs">
                                        {{ truncateFileName(file.name) }}
                                    </span>
                                    <p-badge value="Actual" severity="success" />
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
                <ng-template #file></ng-template>
                <ng-template #empty>
                    <div class="flex items-center justify-center flex-col">
                        <i class="pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"></i>
                        <p class="mt-6 mb-0" i18n="productFileUploadEmptyMessage">Arrastra y suelta archivos aquí para cargarlos.</p>
                    </div>
                </ng-template>
            </p-fileupload>
        </div>
        <div class="flex flex-col gap-2">
            <label for="status" class="font-light" i18n="productStatusFormLabel">Estado</label>
            <p-select
                [options]="statuses"
                formControlName="status"
                optionLabel="name"
                [filter]="false"
                [showClear]="true"
                placeholder="Seleccione"
                class="w-full">
            </p-select>
        </div>
    </form>
    <div class="flex justify-end gap-2 mt-4">
        <p-button label="Cancelar" severity="secondary" (click)="closeModal()" />
        <p-button label="Guardar producto" [disabled]="productForm.invalid" styleClass="bg-slate-700 text-white" (click)="onSubmit()" />
    </div>
</p-dialog>
