<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>{{ 'VISITS.TITLE' | translate }}</ion-title>
  </ion-toolbar>
  <ion-toolbar>
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionChange)="onSearchChange($event)"
      [placeholder]="'VISITS.SEARCH.PLACEHOLDER' | translate"
      animated="true"
      debounce="300"
    ></ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div *ngIf="loading" class="ion-text-center ion-padding">
    <ion-spinner name="crescent"></ion-spinner>
    <p>{{ 'VISITS.LOADING' | translate }}</p>
  </div>

  <ion-list *ngIf="!loading && filteredRutas.length > 0">
    <ion-item-group *ngFor="let ruta of filteredRutas">
      <ion-item-divider sticky>
        <ion-label>
          <h2>{{ 'VISITS.ROUTE_INFO.NUMBER' | translate }}{{ruta.numero_ruta}}</h2>
          <p>{{ruta.fecha | date:'fullDate'}}</p>
        </ion-label>
        <ion-badge slot="end" [color]="getBadgeColor(ruta.estado_ruta.estado_ruta)">
          {{ruta.estado_ruta.estado_ruta | translate}}
        </ion-badge>
      </ion-item-divider>

      <ion-item *ngFor="let nodo of ruta.nodos_rutas">
        <ion-icon name="location-outline" slot="start" color="primary"></ion-icon>
        <ion-label>
          <h3>{{nodo.direccion}}</h3>
          <p>
            <ion-text color="medium">
              {{ 'VISITS.ROUTE_INFO.ARRIVAL_TIME' | translate }}: {{nodo.hora_llegada | date:'shortTime'}}
            </ion-text>
          </p>
          <p>
            <ion-text color="medium">
              {{ 'VISITS.ROUTE_INFO.DEPARTURE_TIME' | translate }}: {{nodo.hora_salida | date:'shortTime'}}
            </ion-text>
          </p>
        </ion-label>
        <ion-note slot="end" color="primary">
          {{nodo.numero_nodo_programado}}
        </ion-note>
      </ion-item>

      <ion-item lines="none">
        <ion-label>
          <p>
            <ion-text color="medium">
              {{ 'VISITS.ROUTE_INFO.ESTIMATED_DURATION' | translate }}: {{ruta.duracion_estimada}} {{ 'VISITS.ROUTE_INFO.MINUTES' | translate }}
            </ion-text>
          </p>
          <p>
            <ion-text color="medium">
              {{ 'VISITS.ROUTE_INFO.TOTAL_DISTANCE' | translate }}: {{ruta.distancia_total}} {{ 'VISITS.ROUTE_INFO.KILOMETERS' | translate }}
            </ion-text>
          </p>
        </ion-label>
      </ion-item>
    </ion-item-group>
  </ion-list>

  <div *ngIf="!loading && filteredRutas.length === 0" class="ion-text-center ion-padding">
    <ion-icon name="calendar-outline" size="large" color="medium"></ion-icon>
    <p>{{ 'VISITS.MESSAGES.NO_VISITS' | translate }}</p>
  </div>
</ion-content>
